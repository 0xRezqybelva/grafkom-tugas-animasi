<!DOCTYPE html>
<html>
<head>
    <title>FBX File Loader with Manual Control</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/libs/fflate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/FBXLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <style>
        #buttonContainer {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
        }
        #openButton, #closeButton {
            padding: 10px 20px;
            font-size: 16px;
            margin: 5px;
        }
    </style>
</head>

<body>
    <div id="buttonContainer">
        <button id="openButton">Open Door</button>
    </div>
    
    <script>
        let scene, camera, renderer, mixer, clock, action;

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xdddddd);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 150, 300);

            const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1.0);
            light.position.set(0, 200, 0);
            scene.add(light);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
            directionalLight.position.set(0, 200, 100);
            scene.add(directionalLight);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.addEventListener('change', render);

            clock = new THREE.Clock();

            const fbxLoader = new THREE.FBXLoader();
            fbxLoader.load('Tesla Model X.fbx', (object) => {
                mixer = new THREE.AnimationMixer(object);
                action = mixer.clipAction(object.animations[0]); // Memilih animasi pertama
                action.clampWhenFinished = true; // Menjaga posisi terakhir animasi saat selesai
                action.loop = THREE.LoopOnce; // Animasi hanya diputar sekali
                action.play();
                action.paused = true; // Awalnya di-pause untuk kontrol manual

                scene.add(object);
                animate();
            });

            window.addEventListener('resize', onWindowResize, false);

            // Event listener untuk tombol buka pintu
            const openButton = document.getElementById('openButton');
            openButton.addEventListener('click', () => {
                if (action) {
                    action.paused = false; // Mulai animasi
                    action.time = 0; // Mulai dari awal
                    action.setDirection(1); // Arah animasi maju (membuka pintu)
                    action.play();
                }
            });

            // Event listener untuk tombol tutup pintu
            const closeButton = document.getElementById('closeButton');
            closeButton.addEventListener('click', () => {
                if (action) {
                    action.paused = false; // Mulai animasi
                    action.time = action.getClip().duration; // Mulai dari akhir
                    action.setDirection(-1); // Arah animasi mundur (menutup pintu)
                    action.play();
                }
            });
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            const delta = clock.getDelta();
            if (mixer) mixer.update(delta); // Update animasi

            renderer.render(scene, camera);
        }

        function render() {
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>
